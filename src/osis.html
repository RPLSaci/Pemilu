<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pemilihan Ketua MPK-OSIS SMAN 1 Cikampek 2024/2025</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./assets/css/main.css">
  <!-- <script src="./assets/js/osis.js"></script> -->
  <script>
    // Inisialisasi fungsi
init();

async function init() {
    // Ambil data login dari localStorage
    const data = JSON.parse(localStorage.getItem("loginObject"));
    console.log(data);

    // Cek apakah data login tersedia
    if (!data || !localStorage.getItem("loginObject")) {
        alert("NO USERDATA, REDIRECTING TO LOGIN");
        document.location.href = "./index.html";
        return; // Hentikan eksekusi lebih lanjut jika data tidak ada
    }

    try {
        // Lakukan permintaan POST untuk memverifikasi pengguna
        const response = await fetch("https://redesigned-lamp-wx969x4q6g6f599x-8080.app.github.dev/api/user/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ username: data.username, password: data.password }),
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();

        if (result.error) {
            // Tangani kesalahan jika ada
            console.error("Login failed: ", result.error);
            alert("Login failed. Please try again.");
        } else {
            // Tampilkan nama pengguna jika login berhasil
            document.querySelector("#usn").textContent = result.user.username;
        }
    } catch (error) {
        console.error("An error occurred while logging in", error);
        alert("An error occurred while logging in. Please try again.");
    }
}

// Fungsi untuk menangani pemilihan kandidat
async function kirim() {
    // Cek apakah ada kandidat yang dipilih
    const selectedKandidat = document.querySelector("input[name='osis']:checked");
    
    if (!selectedKandidat) {
        alert("Pilihlah 1 kandidat");
        return; // Hentikan eksekusi lebih lanjut jika tidak ada kandidat yang dipilih
    }

    const kandidatValue = selectedKandidat.value;
    alert(`Kandidat yang dipilih: ${kandidatValue}`);

    try {
        let pilihan = JSON.parse(localStorage.getItem("Pilihan"))

        if(!pilihan) {
            alert("Kamu harus pilih MPK Dahulu")
            document.location.href = "./mpk.html"
        }

        localStorage.setItem("Pilihan",{"MPK":pilihan.mpk,"OSIS":kandidatValue})

        // Kirim data pemilihan ke server
        // const response = await fetch("https://redesigned-lamp-wx969x4q6g6f599x-8080.app.github.dev/api/vote", {
        //     method: "POST",
        //     headers: {
        //         "Content-Type": "application/json",
        //     },
        //     body: JSON.stringify({ username: data.username, password: data.password, kandidat: kandidatValue }),
        // });

        // if (!response.ok) {
        //     throw new Error(`HTTP error! status: ${response.status}`);
        // }

        // const result = await response.json();

        // if (result.error) {
            // console.error("Voting failed: ", result.error);
            // alert("Voting failed. Please try again.");
        // } else {
            // Tindakan setelah pemilihan berhasil, misalnya mengalihkan halaman
            // alert("Vote submitted successfully!");
            document.location.href = "./success.html"; // Ganti dengan halaman yang sesuai
        // }
    } catch (error) {
        console.error("An error occurred while voting", error);
        alert("An error occurred while voting. Please try again.");
    }
}

  </script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }

    .header {
      background-color: #007BFF;
      /* Primary Color */
    }

    .btn-primary {
      background-color: #007BFF;
    }

    .kandidat-card {
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .selected-card {
      background-color: #e0f7fa; /* Contoh warna untuk card yang dipilih */
    }

    .btn-osis {
      background-color: #007BFF;
      border: none;
    }
  </style>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const kandidatCards = document.querySelectorAll("input[name='osis']");
  
      kandidatCards.forEach((input) => {
        input.addEventListener("change", function() {
          // Hapus kelas "selected-card" dari semua card
          document.querySelectorAll(".kandidat-card").forEach((card) => {
            card.classList.remove("selected-card");
          });
  
          // Tambahkan kelas "selected-card" ke card yang dipilih
          const selectedCard = this.closest("label");
          selectedCard.classList.add("selected-card");
        });
      });
    });
  </script>
</head>

<header>
  <nav class="px-2 sm:px-4 py-2.5 bg-mpk-600 fixed w-full z-20 top-0 left-0 border-b border-mpk-200">
    <div class="container flex flex-wrap items-center justify-between mx-auto">
      <a href="/" class="flex items-center">
        <img src="./assets/img/logo.02c1cc2a.png" class="h-6 mr-3 sm:h-9" alt="MOSANSA Logo">
        <span class="self-center text-xl font-semibold whitespace-nowrap text-white">MOSANSA</span>
      </a>
      <div class="flex md:order-2">
        <span class="self-center text-xl font-semibold whitespace-nowrap text-white" id="usn"></span>
      </div>
    </div>
  </nav>
</header>

<body class="bg-mpk min-h-screen flex flex-col justify-center items-center">
  <h1 class="mt-[5rem] text-2xl text-white font-semibold">Calon Ketua OSIS 2024/2025</h1>

  <!-- Form Username dan Password -->
  <section class="mt-6 w-full max-w-4xl">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <!-- Kandidat 1 -->
      <label for="osis1" class="kandidat-card cursor-pointer">
        <input type="radio" id="osis1" name="osis" value="1" class="hidden">
        <div class="bg-white p-6 rounded-lg w-[80%] lg:w-full m-auto shadow-md">
          <img src="./assets/img/osis1.png" alt="Kandidat 1" class="w-full object-cover rounded-md">
          <h2 class="text-xl font-semibold mt-4">Lee Ghar Mahessa J.</h2>
          <p class="mt-2 text-gray-600">kandidat 1.</p>
        </div>
      </label>

      <!-- Kandidat 2 -->
      <label for="osis2" class="kandidat-card cursor-pointer">
        <input type="radio" id="osis2" name="osis" value="2" class="hidden">
        <div class="bg-white p-6 rounded-lg w-[80%] lg:w-full m-auto shadow-md">
          <img src="./assets/img/osis2.png" alt="Kandidat 2" class="w-full object-cover rounded-md">
          <h2 class="text-xl font-semibold mt-4">M. Ival Ardatta.</h2>
          <p class="mt-2 text-gray-600">kandidat 2.</p>
        </div>
      </label>

      <!-- Kandidat 3 -->
      <label for="osis3" class="kandidat-card cursor-pointer">
        <input type="radio" id="osis3" name="osis" value="3" class="hidden">
        <div class="bg-white p-6 rounded-lg w-[80%] lg:w-full m-auto shadow-md">
          <img src="./assets/img/osis3.png" alt="Kandidat 3" class="w-full object-cover rounded-md">
          <h2 class="text-xl font-semibold mt-4">Syafira Syeikha</h2>
          <p class="mt-2 text-gray-600">kandidat 3.</p>
        </div>
      </label>

      <!-- Kandidat 4 -->
      <label for="osis4" class="kandidat-card cursor-pointer">
        <input type="radio" id="osis4" name="osis" value="4" class="hidden">
        <div class="bg-white p-6 rounded-lg w-[80%] lg:w-full m-auto shadow-md">
          <img src="./assets/img/osis4.png" alt="Kandidat 4" class="w-full object-cover rounded-md">
          <h2 class="text-xl font-semibold mt-4">Altaqirani Farchannaima Zannata</h2>
          <p class="mt-2 text-gray-600">kandidat 4.</p>
        </div>
      </label>
    </div>
    
    <button type="submit" onclick="kirim()" class="left-0 btn text-white px-4 py-2 mt-4 rounded transition duration-300 w-[100%] lg:absolute relative bottom-0">
      Pilih
    </button>
  </section>
</body>
</html>
